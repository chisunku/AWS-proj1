{"ast":null,"code":"var __rest = this && this.__rest || function (s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\nimport { Popup } from 'maplibre-gl';\nimport { ACTIVE_MARKER_COLOR, COLOR_WHITE, MARKER_COLOR } from \"./constants\";\nimport { createMarker } from \"./createMarker\";\nimport { getPopupRenderFunction } from \"./popupRender\";\nimport { isCoordinates } from \"./utils\";\nconst HIDE_TIP = \"amplify-tip\";\nexport function drawUnclusteredLayer(sourceName, map, _a) {\n  var {\n      showMarkerPopup = false\n    } = _a,\n    options = __rest(_a, [\"showMarkerPopup\"]);\n  const unclusteredLayerId = `${sourceName}-layer-unclustered-point`;\n  let selectedId = null;\n  function deselectPoint() {\n    if (selectedId !== null) {\n      map.setLayoutProperty(unclusteredLayerId, \"icon-image\", \"inactive-marker\");\n      selectedId = null;\n    }\n  }\n  const popupRender = options.popupRender ? options.popupRender : getPopupRenderFunction(unclusteredLayerId, options);\n  addUnclusteredMarkerImages(map, options);\n  const defaultUnclusteredPoint = {\n    id: unclusteredLayerId,\n    type: \"symbol\",\n    source: sourceName,\n    filter: [\"!\", [\"has\", \"point_count\"]],\n    layout: {\n      \"icon-image\": \"inactive-marker\"\n    }\n  };\n  map.addLayer(Object.assign({}, defaultUnclusteredPoint));\n  /*\n   * Add css to header to hide default popup tip\n   */\n  if (showMarkerPopup) {\n    const element = document.getElementById(HIDE_TIP);\n    if (!element) {\n      const style = document.createElement(\"style\");\n      style.setAttribute(\"id\", HIDE_TIP);\n      document.head.append(style);\n      style.textContent = \".mapboxgl-popup-tip { display: none; }\";\n    }\n  }\n  map.on(\"click\", function () {\n    deselectPoint();\n  });\n  /*\n   * Set active state on markers when clicked\n   */\n  map.on(\"click\", unclusteredLayerId, function (e) {\n    if (typeof options.onClick === \"function\") options.onClick(e);\n    selectedId = e.features[0].id;\n    map.setLayoutProperty(unclusteredLayerId, \"icon-image\", [\"match\", [\"id\"], selectedId, \"active-marker\", \"inactive-marker\" // default\n    ]);\n    // If popup option is set show a popup on click\n    if (showMarkerPopup) {\n      const selectedFeature = e.features[0];\n      const coordinates = selectedFeature.geometry.coordinates;\n      if (isCoordinates(coordinates)) {\n        const popup = new Popup().setLngLat(coordinates).setHTML(popupRender(selectedFeature)).setOffset(15).addTo(map);\n        popup.on(\"close\", function () {\n          if (selectedId === selectedFeature.id) deselectPoint();\n        });\n      }\n    }\n  });\n  /*\n   * Set cursor style to pointer when mousing over point layer\n   */\n  map.on(\"mouseover\", unclusteredLayerId, function () {\n    map.getCanvas().style.cursor = \"pointer\";\n  });\n  /*\n   * Reset cursor style when the point layer\n   */\n  map.on(\"mouseleave\", unclusteredLayerId, () => {\n    map.getCanvas().style.cursor = \"\";\n  });\n  return {\n    unclusteredLayerId\n  };\n}\n/*\n * Adds marker images to the maplibre canvas to be used for rendering unclustered points\n */\nfunction addUnclusteredMarkerImages(map, _ref) {\n  let {\n    selectedColor = ACTIVE_MARKER_COLOR,\n    selectedBorderColor = COLOR_WHITE,\n    selectedBorderWidth = 4,\n    defaultBorderColor = COLOR_WHITE,\n    defaultBorderWidth = 4,\n    defaultColor: fillColor = MARKER_COLOR,\n    markerImageElement,\n    activeMarkerImageElement\n  } = _ref;\n  const inactiveMarker = markerImageElement || createMarker({\n    fillColor: fillColor,\n    strokeColor: defaultBorderColor,\n    lineWidth: defaultBorderWidth\n  });\n  const activeMarker = activeMarkerImageElement || markerImageElement || createMarker({\n    fillColor: selectedColor,\n    strokeColor: selectedBorderColor,\n    lineWidth: selectedBorderWidth\n  });\n  map.addImage(\"inactive-marker\", inactiveMarker, {\n    pixelRatio: 2\n  });\n  map.addImage(\"active-marker\", activeMarker, {\n    pixelRatio: 2\n  });\n}","map":null,"metadata":{},"sourceType":"module"}